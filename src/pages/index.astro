---
import Navbar from "../components/Navbar/Navbar.astro";
import Hero from "../components/Hero/Hero.astro";
import WhatsAppIntegration from "../components/WhatsAppIntegration/WhatsAppIntegration.astro";
import Features from "../components/Features/Features.astro";
import SystemPreview from "../components/SystemPreview/SystemPreview.astro";
import Prices from "../components/Prices/Prices.astro";
import Table from "../components/Table/Table.astro";
import DistribuidorCTA from "../components/DistribuidorCTA/DistribuidorCTA.astro";
import CTA from "../components/CTA/CTA.astro";
import Footer from "../components/Footer/Footer.astro";
import WhatsAppFloat from "../components/WhatsAppFloat/WhatsAppFloat.astro";
import CompaniesBar from "../components/CompaniesBar/CompaniesBar.astro";
import "../styles/global.scss";
---

<html lang="es-MX">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="dark light" />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <!-- SEO Meta Tags -->
    <title>
      Solución Factura - Sistema de Facturación Electrónica CFDI 4.0
    </title>
    <meta
      name="description"
      content="Sistema completo de facturación electrónica CFDI 4.0 con envío por WhatsApp, facturación masiva, multi-empresa y herramientas contables. Prueba gratis."
    />
    <meta
      name="keywords"
      content="facturación electrónica, CFDI 4.0, facturación masiva, WhatsApp, SAT, XML, DIOT, AutoFactura, sistema contable"
    />
    <meta name="author" content="Solución Factura" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://solucionfactura.mx/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://solucionfactura.mx/" />
    <meta
      property="og:title"
      content="Solución Factura - Sistema de Facturación Electrónica CFDI 4.0"
    />
    <meta
      property="og:description"
      content="Sistema completo de facturación electrónica CFDI 4.0 con envío por WhatsApp, facturación masiva, multi-empresa y herramientas contables. Prueba gratis."
    />
    <meta
      property="og:image"
      content="https://solucionfactura.mx/solucion-factura-logo.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Solución Factura" />
    <meta property="og:locale" content="es_MX" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://solucionfactura.mx/" />
    <meta
      name="twitter:title"
      content="Solución Factura - Sistema de Facturación Electrónica CFDI 4.0"
    />
    <meta
      name="twitter:description"
      content="Sistema completo de facturación electrónica CFDI 4.0 con envío por WhatsApp, facturación masiva, multi-empresa y herramientas contables. Prueba gratis."
    />
    <meta
      name="twitter:image"
      content="https://solucionfactura.mx/solucion-factura-logo.png"
    />

    <!-- Schema.org structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Solución Factura",
        "applicationCategory": "BusinessApplication",
        "description": "Sistema completo de facturación electrónica CFDI 4.0 con envío por WhatsApp, facturación masiva, multi-empresa y herramientas contables.",
        "url": "https://solucionfactura.mx/",
        "operatingSystem": "Web Browser",
        "softwareVersion": "4.0",
        "countriesSupported": "MX",
        "inLanguage": "es-MX",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "MXN",
          "description": "Prueba gratuita disponible",
          "url": "https://app.solucionfactura.mx/register"
        },
        "featureList": [
          "Facturación Masiva",
          "Envío por WhatsApp",
          "Multi Empresa",
          "Descarga XML",
          "AutoFactura",
          "DIOT Automático"
        ],
        "provider": {
          "@type": "Organization",
          "name": "Solución Factura",
          "url": "https://solucionfactura.mx/",
          "logo": "https://solucionfactura.mx/solucion-factura-logo.png",
          "address": {
            "@type": "PostalAddress",
            "addressCountry": "MX"
          },
          "contactPoint": [
            {
              "@type": "ContactPoint",
              "telephone": "+52-55-9331-4767",
              "contactType": "sales",
              "areaServed": "MX",
              "availableLanguage": "Spanish"
            },
            {
              "@type": "ContactPoint",
              "telephone": "+52-55-7601-7764",
              "contactType": "technical support",
              "areaServed": "MX",
              "availableLanguage": "Spanish"
            }
          ],
          "sameAs": ["https://wa.me/525576017764"]
        }
      }
    </script>

    <!-- Script de tema - debe ejecutarse lo antes posible -->
    <script is:inline>
      // theme.js - Script global para inicialización del tema
      // Este script debe ejecutarse lo antes posible para evitar flash del tema incorrecto

      (function () {
        "use strict";

        // Función para inicializar el tema
        function initTheme() {
          const htmlElement = document.documentElement;

          // Obtener el tema guardado en localStorage
          const savedTheme = localStorage.getItem("theme");

          // Detectar preferencia del sistema si no hay tema guardado
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;

          // Determinar qué tema usar
          let themeToApply;
          if (savedTheme) {
            themeToApply = savedTheme;
          } else {
            // Si no hay tema guardado, usar la preferencia del sistema
            themeToApply = prefersDark ? "dark" : "light";
            // Guardar la preferencia detectada
            localStorage.setItem("theme", themeToApply);
          }

          // Aplicar el tema
          if (themeToApply === "light") {
            htmlElement.setAttribute("data-theme", "light");
          } else {
            htmlElement.removeAttribute("data-theme");
          }
        }

        // Función para escuchar cambios en la preferencia del sistema
        function watchSystemTheme() {
          if (window.matchMedia) {
            const mediaQuery = window.matchMedia(
              "(prefers-color-scheme: dark)",
            );

            mediaQuery.addEventListener("change", (e) => {
              // Solo actualizar si no hay tema guardado manualmente
              const savedTheme = localStorage.getItem("theme");
              if (!savedTheme) {
                const htmlElement = document.documentElement;
                if (e.matches) {
                  // Sistema prefiere oscuro
                  htmlElement.removeAttribute("data-theme");
                  localStorage.setItem("theme", "dark");
                } else {
                  // Sistema prefiere claro
                  htmlElement.setAttribute("data-theme", "light");
                  localStorage.setItem("theme", "light");
                }

                // Disparar evento personalizado
                window.dispatchEvent(
                  new CustomEvent("themeChanged", {
                    detail: {
                      theme: e.matches ? "dark" : "light",
                      source: "system",
                    },
                  }),
                );
              }
            });
          }
        }

        // Función para obtener el tema actual
        function getCurrentTheme() {
          const htmlElement = document.documentElement;
          return htmlElement.getAttribute("data-theme") || "dark";
        }

        // Función para cambiar el tema programáticamente
        function setTheme(theme) {
          const htmlElement = document.documentElement;

          if (theme === "light") {
            htmlElement.setAttribute("data-theme", "light");
          } else {
            htmlElement.removeAttribute("data-theme");
            theme = "dark"; // Normalizar
          }

          localStorage.setItem("theme", theme);

          // Disparar evento personalizado
          window.dispatchEvent(
            new CustomEvent("themeChanged", {
              detail: { theme, source: "manual" },
            }),
          );

          return theme;
        }

        // Función para alternar el tema
        function toggleTheme() {
          const currentTheme = getCurrentTheme();
          const newTheme = currentTheme === "light" ? "dark" : "light";
          return setTheme(newTheme);
        }

        // Inicializar inmediatamente
        initTheme();

        // Configurar el observador del sistema cuando el DOM esté listo
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", watchSystemTheme);
        } else {
          watchSystemTheme();
        }

        // Exponer funciones globales útiles
        window.themeManager = {
          getCurrentTheme,
          setTheme,
          toggleTheme,
          init: initTheme,
        };
      })();
    </script>
  </head>
  <body>
    <Navbar />
    <Hero />
    <CompaniesBar />
    <WhatsAppIntegration />
    <Features />
    <SystemPreview />
    <Prices />
    <Table />
    <DistribuidorCTA />
    <CTA />
    <Footer />
    <WhatsAppFloat />
  </body>
</html>
