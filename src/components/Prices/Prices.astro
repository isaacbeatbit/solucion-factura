---
import "./prices.scss";
---

<script>
  let selectedPlan = null;
  let showModal = false;

  function openModal(plan) {
    selectedPlan = plan;
    showModal = true;
    document.body.style.overflow = "hidden";
    updateModal();
  }

  function closeModal() {
    showModal = false;
    document.body.style.overflow = "";
    updateModal();
  }

  function updateModal() {
    const modal = document.getElementById("plan-modal");
    if (modal) {
      modal.style.display = showModal ? "flex" : "none";
    }
  }

  // Cerrar modal al hacer click fuera del contenido
  window.addEventListener("click", function (e) {
    const modal = document.getElementById("plan-modal");
    if (showModal && modal && e.target === modal) {
      closeModal();
    }
  });
</script>

<section id="planes" class="pricing">
  <div class="layout-container">
    <div class="section-header">
      <h2 class="title-section">Planes que se adaptan a tu negocio</h2>
      <p class="subtitle">
        Desde emprendedores hasta grandes empresas, tenemos el plan perfecto
        para ti
      </p>
    </div>

    <div class="pricing-grid">
      <div class="pricing-card">
        <h3 class="title-medium">Empresa</h3>
        <div class="plan-pricing">
          <span class="plan-price">
            <span class="currency">$</span>960
          </span>
          <span class="plan-period">por año</span>
        </div>

        <ul class="plan-features">
          <li>1,200 timbres incluidos</li>
          <li>50 Empresas</li>
          <li>Facturas y complementos</li>
          <li>Soporte por email</li>
        </ul>

        <button
          type="button"
          class="btn btn-primary plan-button"
          data-plan="empresa"
        >
          Comenzar Ahora
        </button>
      </div>

      <div class="pricing-card featured">
        <h3 class="title-medium">Premium</h3>
        <div class="plan-pricing">
          <span class="plan-price">
            <span class="currency">$</span>2,075
          </span>
          <span class="plan-period">por año</span>
        </div>

        <ul class="plan-features">
          <li>6,000 timbres incluidos</li>
          <li>Empresas ilimitadas</li>
          <li>Envío por WhatsApp</li>
          <li>Descarga XML masiva</li>
          <li>Importa historial</li>
          <li>Conciliación bancaria</li>
          <li>Soporte prioritario</li>
        </ul>

        <button
          type="button"
          class="btn btn-primary plan-button"
          data-plan="premium"
        >
          Más Popular
        </button>
      </div>

      <div class="pricing-card">
        <h3 class="title-medium">Premium PLUS</h3>
        <div class="plan-pricing">
          <span class="plan-price">
            <span class="currency">$</span>2,799
          </span>
          <span class="plan-period">por año</span>
        </div>

        <ul class="plan-features">
          <li>10,000 timbres incluidos</li>
          <li>AutoFactura incluida</li>
          <li>WhatsApp con tu número</li>
          <li>Email personalizado</li>
          <li>Complementos avanzados</li>
          <li>Generación DIOT</li>
          <li>Soporte dedicado</li>
        </ul>

        <button
          type="button"
          class="btn btn-primary plan-button"
          data-plan="premium-plus"
        >
          Plan Completo
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Modal centrado para selección de cuenta -->
<style>
  #plan-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.45);
    align-items: center;
    justify-content: center;
  }
  #plan-modal.active {
    display: flex;
  }
  #plan-modal .modal-content {
    background: #fff;
    color: #222;
    border-radius: 12px;
    max-width: 340px;
    width: 90vw;
    padding: 2rem 1.5rem 1.5rem 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
    text-align: center;
    position: relative;
  }
  #plan-modal .close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #888;
    cursor: pointer;
  }
  #plan-modal .modal-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  #plan-modal .modal-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }
  #plan-modal .modal-actions a {
    display: block;
    padding: 0.75rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: background 0.15s;
  }
  #plan-modal .modal-actions a.yes {
    background: #1a6dcc;
    color: #fff;
  }
  #plan-modal .modal-actions a.no {
    background: #f0f4ff;
    color: #1a6dcc;
    border: 1px solid #1a6dcc;
  }
  #plan-modal .modal-actions a:hover {
    opacity: 0.85;
  }
</style>
<div id="plan-modal">
  <div class="modal-content">
    <button class="close-modal" aria-label="Cerrar">&times;</button>
    <div class="modal-title">¿Ya tienes cuenta?</div>
    <div class="modal-actions">
      <a class="yes" id="modal-yes-link" href="" target="_blank" rel="noopener"
        >Sí, comprar</a
      >
      <a
        class="no"
        id="modal-register-link"
        href="https://app.solucionfactura.mx/register"
        target="_blank"
        rel="noopener">No, registrarme</a
      >
    </div>
  </div>
</div>
<script>
  // Abrir modal al hacer click en cualquier botón de plan
  document.querySelectorAll(".plan-button").forEach((btn) => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      const plan = btn.getAttribute("data-plan");
      const modal = document.getElementById("plan-modal");
      const registerLink = document.getElementById("modal-register-link");
      const yesLink = document.getElementById("modal-yes-link");

      // Links de compra y registro por plan
      let yesUrl = "";
      let regUrl = "";

      if (plan === "emprende") {
        yesUrl =
          "https://pagos.solucionfiscal.online/subscribe/6677460f60546edc2553076f/plan-emprende";
        regUrl = "https://app.solucionfactura.mx/register?plan=emprende";
      } else if (plan === "crece") {
        yesUrl =
          "https://pagos.solucionfiscal.online/subscribe/6677544560546edc255308ea/plan-crece";
        regUrl = "https://app.solucionfactura.mx/register?plan=crece";
      } else if (plan === "empresa") {
        yesUrl =
          "https://pagos.solucionfiscal.online/subscribe/667754e89b6a9adc0e5693f1/plan-empresa";
        regUrl = "https://app.solucionfactura.mx/register?plan=empresa";
      } else if (plan === "premium") {
        yesUrl =
          "https://pagos.solucionfiscal.online/subscribe/6677554f9b6a9adc0e5693f6/plan-premium";
        regUrl = "https://app.solucionfactura.mx/register?plan=premium";
      } else if (plan === "premium-plus") {
        yesUrl =
          "https://pagos.solucionfiscal.online/subscribe/667756fe9b6a9adc0e569424/plan-premium-plus";
        regUrl = "https://app.solucionfactura.mx/register?plan=premium-plus";
      } else {
        // fallback: registro general
        regUrl = "https://app.solucionfactura.mx/register";
      }

      yesLink.setAttribute("href", yesUrl);
      registerLink.setAttribute("href", regUrl);

      modal.classList.add("active");
      document.body.style.overflow = "hidden";
    });
  });
  // Cerrar modal al hacer click en la X
  document
    .querySelector("#plan-modal .close-modal")
    .addEventListener("click", function () {
      document.getElementById("plan-modal").classList.remove("active");
      document.body.style.overflow = "";
    });
  // Cerrar modal al hacer click fuera del contenido
  document.getElementById("plan-modal").addEventListener("click", function (e) {
    if (e.target === this) {
      this.classList.remove("active");
      document.body.style.overflow = "";
    }
  });
</script>

<!-- Modal centrado para selección de cuenta -->
<style>
  #plan-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.45);
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s;
  }
  #plan-modal .modal-content {
    background: #fff;
    color: #222;
    border-radius: 12px;
    max-width: 340px;
    width: 90vw;
    padding: 2rem 1.5rem 1.5rem 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
    text-align: center;
    position: relative;
  }
  #plan-modal .close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #888;
    cursor: pointer;
  }
  #plan-modal .modal-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  #plan-modal .modal-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }
  #plan-modal .modal-actions a {
    display: block;
    padding: 0.75rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: background 0.15s;
  }
  #plan-modal .modal-actions a.yes {
    background: #1a6dcc;
    color: #fff;
  }
  #plan-modal .modal-actions a.no {
    background: #f0f4ff;
    color: #1a6dcc;
    border: 1px solid #1a6dcc;
  }
  #plan-modal .modal-actions a:hover {
    opacity: 0.85;
  }
</style>
<div id="plan-modal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeModal()" aria-label="Cerrar"
      >&times;</button
    >
    <div class="modal-title">¿Ya tienes cuenta?</div>
    <div class="modal-actions">
      <a class="yes" href="https://app.solucionfactura.mx/login">Sí, ingresar</a
      >
      <a class="no" id="modal-register-link" href="#">No, quiero registrarme</a>
    </div>
  </div>
</div>
<script>
  // Actualiza el link de registro según el plan seleccionado
  function updateRegisterLink() {
    const link = document.getElementById("modal-register-link");
    if (!link) return;
    let url = "https://app.solucionfactura.mx/register";
    if (selectedPlan) {
      url += "?plan=" + selectedPlan;
    }
    link.href = url;
  }
  // Observa cambios en el modal y actualiza el link
  const observer = new MutationObserver(updateRegisterLink);
  observer.observe(document.getElementById("plan-modal"), {
    attributes: true,
    childList: true,
    subtree: true,
  });
  // También actualiza al abrir el modal
  window.openModal = function (plan) {
    selectedPlan = plan;
    showModal = true;
    document.body.style.overflow = "hidden";
    updateModal();
    updateRegisterLink();
  };
</script>
