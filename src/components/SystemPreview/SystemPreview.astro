---
import "./system-preview.scss";
---

<section class="system-preview">
  <div class="container">
    <div class="section-header">
      <h2 class="title-section">Conoce nuestro sistema</h2>
      <p class="subtitle">
        Explora la interfaz intuitiva y las funcionalidades avanzadas de
        Solución Factura
      </p>
    </div>

    <div
      class="carousel-wrapper"
      style="position: relative; max-width: 900px; margin: 0 auto;"
    >
      <div
        class="carousel-container"
        id="carousel"
        style="overflow: hidden; border-radius: 12px; box-shadow: var(--theme-shadow-xl); background: var(--bg-card);"
      >
        <div
          class="carousel-track"
          id="carousel-track"
          style="display: flex; transition: transform 0.5s ease;"
        >
          <div
            class="carousel-slide active"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/1"
              alt="Dashboard Principal"
              loading="eager"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Dashboard Principal
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Vista general de tu facturación
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/2"
              alt="Generación de Facturas"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Generación de Facturas
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Crea facturas de forma rápida y sencilla
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/3"
              alt="Convertidor PDF a Excel"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Convertidor PDF a Excel
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Convierte estados de cuenta a Excel
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/4"
              alt="Multi-empresa"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Multi-empresa
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Maneja múltiples RFC desde un solo lugar
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/5"
              alt="Descarga XML"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Descarga XML
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Descarga masiva del SAT
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/6"
              alt="Conciliación Bancaria"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Conciliación Bancaria
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Automatiza tu contabilidad
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/7"
              alt="Facturación Masiva"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Facturación Masiva
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Procesa miles de facturas con un solo clic
              </p>
            </div>
          </div>

          <div
            class="carousel-slide"
            style="min-width: 100%; flex-shrink: 0; position: relative; width: 100%; height: 450px; overflow: hidden; border-radius: 8px;"
          >
            <img
              src="https://solucionfactura.mx/images/8"
              alt="Conciliación Bancaria Avanzada"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
            />
            <div
              class="slide-overlay"
              style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 2rem; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);"
            >
              <h3
                style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"
              >
                Conciliación Bancaria Avanzada
              </h3>
              <p style="margin: 0; font-size: 1rem; opacity: 0.9;">
                Automatiza la conciliación de tus cuentas
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Controls -->
      <button
        class="carousel-btn carousel-btn--prev"
        id="prev-btn"
        aria-label="Anterior"
        style="position: absolute; top: 50%; transform: translateY(-50%); left: 16px; background: var(--bg-card); border: 2px solid var(--border-color); color: var(--text-primary); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; z-index: 10; box-shadow: var(--theme-shadow-md); backdrop-filter: blur(10px);"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M15 18L9 12L15 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <button
        class="carousel-btn carousel-btn--next"
        id="next-btn"
        aria-label="Siguiente"
        style="position: absolute; top: 50%; transform: translateY(-50%); right: 16px; background: var(--bg-card); border: 2px solid var(--border-color); color: var(--text-primary); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; z-index: 10; box-shadow: var(--theme-shadow-md); backdrop-filter: blur(10px);"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M9 18L15 12L9 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <!-- Dots Indicator -->
      <div
        class="carousel-dots"
        id="carousel-dots"
        style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 0.75rem; margin-bottom: 2rem;"
      >
      </div>
    </div>
  </div>
</section>

<script is:inline>
  window.addEventListener("load", function () {
    console.log("Carousel initializing...");

    const track = document.getElementById("carousel-track");
    const slides = track.querySelectorAll(".carousel-slide");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const dotsContainer = document.getElementById("carousel-dots");

    let currentSlide = 0;
    const totalSlides = slides.length;
    let autoplayInterval;

    console.log("Found", totalSlides, "slides");

    // Create dots
    function createDots() {
      dotsContainer.innerHTML = "";
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement("button");
        dot.style.cssText =
          "width: 12px; height: 12px; border-radius: 50%; background: var(--border-light); border: none; cursor: pointer; transition: all 0.3s ease;";
        dot.setAttribute("aria-label", "Ir a slide " + (i + 1));

        if (i === 0) {
          dot.style.background = "var(--secondary)";
          dot.style.transform = "scale(1.3)";
        }

        (function (index) {
          dot.addEventListener("click", function () {
            goToSlide(index);
          });
        })(i);

        dotsContainer.appendChild(dot);
      }
    }

    // Update carousel display
    function updateCarousel() {
      console.log("Moving to slide:", currentSlide);

      // Move track - cada slide es 100% del contenedor
      const translateX = -currentSlide * 100;
      track.style.transform = "translateX(" + translateX + "%)";

      // Update dots
      const dots = dotsContainer.querySelectorAll("button");
      for (let i = 0; i < dots.length; i++) {
        if (i === currentSlide) {
          dots[i].style.background = "var(--secondary)";
          dots[i].style.transform = "scale(1.3)";
        } else {
          dots[i].style.background = "var(--border-light)";
          dots[i].style.transform = "scale(1)";
        }
      }
    }

    // Navigation functions
    function goToSlide(index) {
      currentSlide = index;
      updateCarousel();
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateCarousel();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateCarousel();
    }

    // Autoplay functions
    function startAutoplay() {
      autoplayInterval = setInterval(nextSlide, 4000);
    }

    function stopAutoplay() {
      if (autoplayInterval) {
        clearInterval(autoplayInterval);
        autoplayInterval = null;
      }
    }

    // Event listeners
    prevBtn.addEventListener("click", function () {
      prevSlide();
      stopAutoplay();
      setTimeout(startAutoplay, 5000);
    });

    nextBtn.addEventListener("click", function () {
      nextSlide();
      stopAutoplay();
      setTimeout(startAutoplay, 5000);
    });

    // Hover events
    prevBtn.addEventListener("mouseenter", function () {
      this.style.background = "var(--secondary)";
      this.style.borderColor = "var(--secondary)";
      this.style.color = "white";
      this.style.transform = "translateY(-50%) scale(1.05)";
      this.style.boxShadow = "var(--glow)";
    });

    prevBtn.addEventListener("mouseleave", function () {
      this.style.background = "var(--bg-card)";
      this.style.borderColor = "var(--border-color)";
      this.style.color = "var(--text-primary)";
      this.style.transform = "translateY(-50%) scale(1)";
      this.style.boxShadow = "var(--theme-shadow-md)";
    });

    nextBtn.addEventListener("mouseenter", function () {
      this.style.background = "var(--secondary)";
      this.style.borderColor = "var(--secondary)";
      this.style.color = "white";
      this.style.transform = "translateY(-50%) scale(1.05)";
      this.style.boxShadow = "var(--glow)";
    });

    nextBtn.addEventListener("mouseleave", function () {
      this.style.background = "var(--bg-card)";
      this.style.borderColor = "var(--border-color)";
      this.style.color = "var(--text-primary)";
      this.style.transform = "translateY(-50%) scale(1)";
      this.style.boxShadow = "var(--theme-shadow-md)";
    });

    // Pause on hover
    const carousel = document.getElementById("carousel");
    carousel.addEventListener("mouseenter", stopAutoplay);
    carousel.addEventListener("mouseleave", startAutoplay);

    // Touch support
    let startX = 0;
    carousel.addEventListener("touchstart", function (e) {
      startX = e.touches[0].clientX;
      stopAutoplay();
    });

    carousel.addEventListener("touchend", function (e) {
      const endX = e.changedTouches[0].clientX;
      const diffX = startX - endX;

      if (Math.abs(diffX) > 50) {
        if (diffX > 0) {
          nextSlide();
        } else {
          prevSlide();
        }
      }
      setTimeout(startAutoplay, 3000);
    });

    // Keyboard navigation
    document.addEventListener("keydown", function (e) {
      if (e.key === "ArrowLeft") {
        prevSlide();
        stopAutoplay();
        setTimeout(startAutoplay, 3000);
      } else if (e.key === "ArrowRight") {
        nextSlide();
        stopAutoplay();
        setTimeout(startAutoplay, 3000);
      }
    });

    // Initialize
    createDots();
    updateCarousel();
    startAutoplay();

    console.log("Carousel initialized successfully");
  });
</script>
